{"version":3,"sources":["components/editable-table/editable-context.js","components/editable-table/EditableCell.jsx","components/editable-table/EditableRow.jsx","components/editable-table/EditableTable.jsx","components/csr-report/CsrReport.jsx","App.jsx","index.js"],"names":["React","createContext","EditableCell","title","editable","children","dataIndex","record","handleSave","restProps","cellKey","Array","isArray","join","inputRef","useRef","useState","editing","setEditing","form","useContext","EditableContext","useEffect","current","focus","toggleEdit","setFieldsValue","get","save","a","validateFields","values","nextRecord","Object","entries","forEach","k","v","set","console","log","childNode","Item","name","className","ref","onPressEnter","onBlur","onClick","EditableRow","index","props","Form","useForm","component","Provider","value","EditableTable","columns","dataSource","rest","bordered","size","pagination","components","body","row","cell","renderer","clsx","Number","currency","separator","symbol","precision","format","DATA_SOURCE","group","item","tw","A","B","cn","eu","CsrReport","setDataSource","prev","map","data","groupByGroup","colSpan","width","render","rowSpan","length","align","COLUMNS","groupBy","property","col","_col","__col","onCell","style","rowKey","App","ReactDOM","StrictMode","document","getElementById"],"mappings":"oUAEeA,MAAMC,cAAc,M,QCIpB,SAASC,EAAT,GAQZ,EAPDC,MAOE,IANFC,EAMC,EANDA,SACAC,EAKC,EALDA,SACAC,EAIC,EAJDA,UACAC,EAGC,EAHDA,OACAC,EAEC,EAFDA,WACGC,EACF,iFACKC,EAAUC,MAAMC,QAAQN,GAAaA,EAAUO,KAAK,KAAOP,EAC3DQ,EAAWC,iBAAO,MAFvB,EAG6BC,oBAAS,GAHtC,mBAGMC,EAHN,KAGeC,EAHf,KAIKC,EAAOC,qBAAWC,GACxBC,qBAAU,WACJL,GACFH,EAASS,QAAQC,UAElB,CAACP,IAEJ,IAAMQ,EAAa,WACjBP,GAAYD,GACZE,EAAKO,eAAL,eACGhB,EAAUiB,cAAIpB,EAAQD,MAIrBsB,EAAI,uCAAG,8BAAAC,EAAA,+EAEYV,EAAKW,iBAFjB,OAEHC,EAFG,OAGTN,IACMO,EAJG,eAIezB,GACxB0B,OAAOC,QAAQH,GAAQI,SAAQ,mCAAEC,EAAF,KAAKC,EAAL,YAAYC,cAAIN,EAAYI,EAAGC,MAC9D7B,EAAW,eAAKwB,IANP,kDAQTO,QAAQC,IAAI,eAAZ,MARS,0DAAH,qDAYNC,EAAYpC,EAahB,OAZID,IACFqC,EAAYxB,EACV,cAAC,IAAKyB,KAAN,CAAWC,KAAMjC,EAASkC,UAAU,MAApC,SACE,cAAC,IAAD,CAAOC,IAAK/B,EAAUgC,aAAclB,EAAMmB,OAAQnB,MAGpD,qBAAKgB,UAAU,4BAA4BI,QAASvB,EAApD,SACGpB,KAKA,8CAAQI,GAAR,aAAoBgC,KCpDd,SAASQ,EAAT,GAA0C,EAAnBC,MAAoB,IAAVC,EAAS,2BACxCC,IAAKC,UAAblC,EADgD,oBAEvD,OACE,cAAC,IAAD,CAAMA,KAAMA,EAAMmC,WAAW,EAA7B,SACE,cAAC,EAAgBC,SAAjB,CAA0BC,MAAOrC,EAAjC,SACE,kCAAQgC,QCJD,SAASM,EAAT,GAAoE,IAAD,IAA1CC,eAA0C,MAAhC,GAAgC,MAA5BC,kBAA4B,MAAf,GAAe,EAARC,EAAQ,wCAChF,OACE,cAAC,IAAD,aACEC,UAAQ,EACRjB,UAAU,gBACVkB,KAAK,QACLC,YAAY,EACZL,QAASA,EACTC,WAAYA,EACZK,WAAY,CACVC,KAAM,CACJC,IAAKjB,EACLkB,KAAMjE,KAGN0D,ICbV,IAAMQ,EAAW,SAAC9D,GAAD,OAAe,SAACkD,EAAOjD,GACtC,OACE,qBACEqC,UAAWyB,YAAK,MAAO,CAAE,eAAgBC,OAAO3C,cAAIpB,EAAQD,MAAgBgE,OAAOd,KADrF,SAEGe,IAASf,EAAO,CAAEgB,UAAW,IAAKC,OAAQ,GAAIC,UAAW,IAAKC,aA6H/DC,EAAc,CAClB,CACEC,MAAO,uCACPC,KAAM,eACNC,GAAI,CAAEC,EAAG,KAAMC,EAAG,MAClBC,GAAI,CAAEF,EAAG,KAAMC,EAAG,MAClBE,GAAI,CAAEH,EAAG,KAAMC,EAAG,OAEpB,CACEJ,MAAO,uCACPC,KAAM,qBACNC,GAAI,CAAEC,EAAG,EAAKC,EAAG,GACjBC,GAAI,CAAEF,EAAG,QAASC,EAAG,SACrBE,GAAI,CAAEH,EAAG,OAAQC,EAAG,SAEtB,CACEJ,MAAO,uCACPC,KAAM,eACNC,GAAI,CAAEC,EAAG,MAAOC,EAAG,OACnBC,GAAI,CAAEF,EAAG,OAAQC,EAAG,QACpBE,GAAI,CAAEH,EAAG,KAAMC,EAAG,OAEpB,CACEJ,MAAO,uCACPC,KAAM,eACNC,GAAI,CAAEC,EAAG,EAAKC,EAAG,GACjBC,GAAI,CAAEF,EAAG,EAAKC,EAAG,GACjBE,GAAI,CAAEH,EAAG,QAASC,EAAG,UAGvB,CACEJ,MAAO,iCACPC,KAAM,iDACNC,GAAI,CAAEC,EAAG,EAAKC,EAAG,GACjBC,GAAI,CAAEF,EAAG,YAAaC,EAAG,aACzBE,GAAI,CAAEH,EAAG,EAAKC,EAAG,IAEnB,CACEJ,MAAO,iCACPC,KAAM,uDACNC,GAAI,CAAEC,EAAG,EAAKC,EAAG,GACjBC,GAAI,CAAEF,EAAG,WAAYC,EAAG,YACxBE,GAAI,CAAEH,EAAG,EAAKC,EAAG,IAEnB,CACEJ,MAAO,iCACPC,KAAM,iDACNC,GAAI,CAAEC,EAAG,EAAKC,EAAG,GACjBC,GAAI,CAAEF,EAAG,EAAKC,EAAG,GACjBE,GAAI,CAAEH,EAAG,EAAKC,EAAG,IAGnB,CACEJ,MAAO,iDACPC,KAAM,GACNC,GAAI,CAAEC,EAAG,YAAaC,EAAG,aACzBC,GAAI,CAAEF,EAAG,aAAcC,EAAG,cAC1BE,GAAI,CAAEH,EAAG,YAAaC,EAAG,eAId,SAASG,IACtB,SAAS5E,EAAW0D,GAClBmB,GAAc,SAACC,GAAD,OAAUA,EAAKC,KAAI,SAACC,GAAD,OAAWA,EAAKV,OAASZ,EAAIY,KAAOZ,EAAMsB,QAG7E,IACM9B,EA3LQ,yEAAyB,IAAtB+B,oBAAH,MAAkB,GAAlB,QAAgC,CAC9C,CACEtF,MAAO,GACPuF,QAAS,EACTpF,UAAW,QACXqF,MAAO,QACPC,OAAQ,SAACpC,EAAOU,GACd,IAAMnC,EAAS0D,EAAajC,GAC5B,MAAO,CACLnD,SAAU,qBAAKuC,UAAU,OAAf,SAAuBY,IACjCL,MAAO,CACL0C,QAAS9D,EAAO,GAAG+C,OAASZ,EAAIY,KAAO/C,EAAO+D,OAAS,EACvDJ,QAAsB,KAAbxB,EAAIY,KAAc,EAAI,MAKvC,CACE3E,MAAO,eACPuF,QAAS,EACTrF,SAAU,CACR,CACEF,MAAO,OACPG,UAAW,OACXoF,QAAS,EACTG,QAAS,EACTF,MAAO,QACPC,OAAQ,SAACpC,GACP,MAAO,CACLnD,SAAU,qBAAKuC,UAAU,OAAf,SAAuBY,IACjCL,MAAO,CACLuC,QAAmB,KAAVlC,EAAe,EAAI,QAOxC,CACErD,MAAO,eACPE,SAAU,CACR,CACEF,MAAO,SACPE,SAAU,CACR,CACEF,MAAO,IACPG,UAAW,CAAC,KAAM,KAClByF,MAAO,QACPH,OAAQxB,EAAS,CAAC,KAAM,MACxBhE,UAAU,EACVuF,MAAO,SAET,CACExF,MAAO,IACPG,UAAW,CAAC,KAAM,KAClByF,MAAO,QACPH,OAAQxB,EAAS,CAAC,KAAM,MACxBhE,UAAU,EACVuF,MAAO,aAMjB,CACExF,MAAO,eACPE,SAAU,CACR,CACEF,MAAO,QACPG,UAAW,KACXD,SAAU,CACR,CACEF,MAAO,IACPG,UAAW,CAAC,KAAM,KAClByF,MAAO,QACPH,OAAQxB,EAAS,CAAC,KAAM,MACxBhE,UAAU,EACVuF,MAAO,SAET,CACExF,MAAO,IACPG,UAAW,CAAC,KAAM,KAClByF,MAAO,QACPH,OAAQxB,EAAS,CAAC,KAAM,MACxBhE,UAAU,EACVuF,MAAO,aAMjB,CACExF,MAAO,eACPE,SAAU,CACR,CACEF,MAAO,kBACPG,UAAW,KACXD,SAAU,CACR,CACEF,MAAO,IACPG,UAAW,CAAC,KAAM,KAClByF,MAAO,QACPH,OAAQxB,EAAS,CAAC,KAAM,MACxBhE,UAAU,EACVuF,MAAO,SAET,CACExF,MAAO,IACPG,UAAW,CAAC,KAAM,KAClByF,MAAO,QACPH,OAAQxB,EAAS,CAAC,KAAM,MACxBhE,UAAU,EACVuF,MAAO,cA2EDK,CAAQ,CAAEP,aADLQ,kBAAQrB,EAAasB,mBAAS,YACTX,KAAI,SAACY,GAAD,mBAAC,eAC1CA,GACCA,EAAI9F,UAAY,CAClBA,SAAU8F,EAAI9F,SAASkF,KAAI,SAACa,GAAD,mBAAC,eACvBA,GACCA,EAAK/F,UAAY,CACnBA,SAAU+F,EAAK/F,SAASkF,KAAI,SAACc,GAAD,mBAAC,eACxBA,GACCA,EAAMjG,UAAY,CACpBkG,OAAQ,SAAC/F,GAAD,MAAa,CACnBC,aACAD,SACAH,SAAUiG,EAAMjG,SAChBE,UAAW+F,EAAM/F,UACjBH,MAAOkG,EAAMlG,uBApBO,EA6BEa,mBAAS4D,GA7BX,mBA6B3BjB,EA7B2B,KA6Bf0B,EA7Be,KA8BlC,OACE,gCACE,sBAAKzC,UAAU,OAAf,UACE,cAAC,IAAD,uBACA,cAAC,IAAD,0BAEF,cAACa,EAAD,CACE8C,MAAO,CAAEZ,MAAO,MAChBjC,QAASA,EACTC,WAAYA,EACZ6C,OAAO,SAET,cAAC,IAAD,wB,OC5OS,SAASC,IACtB,OACE,qBAAK7D,UAAU,oBAAf,SACE,cAACwC,EAAD,MCCNsB,IAASd,OACP,cAAC,IAAMe,WAAP,UACE,cAACF,EAAD,MAEFG,SAASC,eAAe,W","file":"static/js/main.c15544b0.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nexport default React.createContext(null);\r\n","import React, { useContext, useState, useEffect, useRef } from 'react';\r\nimport { Input, Form } from 'antd';\r\nimport { set, get } from 'lodash';\r\n\r\nimport EditableContext from './editable-context';\r\n\r\nexport default function EditableCell({\r\n  title,\r\n  editable,\r\n  children,\r\n  dataIndex,\r\n  record,\r\n  handleSave,\r\n  ...restProps\r\n}) {\r\n  const cellKey = Array.isArray(dataIndex) ? dataIndex.join('.') : dataIndex;\r\n  const inputRef = useRef(null);\r\n  const [editing, setEditing] = useState(false);\r\n  const form = useContext(EditableContext);\r\n  useEffect(() => {\r\n    if (editing) {\r\n      inputRef.current.focus();\r\n    }\r\n  }, [editing]);\r\n\r\n  const toggleEdit = () => {\r\n    setEditing(!editing);\r\n    form.setFieldsValue({\r\n      [cellKey]: get(record, dataIndex),\r\n    });\r\n  };\r\n\r\n  const save = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      toggleEdit();\r\n      const nextRecord = { ...record };\r\n      Object.entries(values).forEach(([k, v]) => set(nextRecord, k, v));\r\n      handleSave({ ...nextRecord });\r\n    } catch (errInfo) {\r\n      console.log('Save failed:', errInfo);\r\n    }\r\n  };\r\n\r\n  let childNode = children;\r\n  if (editable) {\r\n    childNode = editing ? (\r\n      <Form.Item name={cellKey} className=\"m-0\">\r\n        <Input ref={inputRef} onPressEnter={save} onBlur={save} />\r\n      </Form.Item>\r\n    ) : (\r\n      <div className=\"editable-cell cursor-text\" onClick={toggleEdit}>\r\n        {children}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <td {...restProps}>{childNode}</td>;\r\n}\r\n","import React from 'react';\r\nimport { Form } from 'antd';\r\n\r\nimport EditableContext from './editable-context';\r\n\r\nexport default function EditableRow({ index, ...props }) {\r\n  const [form] = Form.useForm();\r\n  return (\r\n    <Form form={form} component={false}>\r\n      <EditableContext.Provider value={form}>\r\n        <tr {...props} />\r\n      </EditableContext.Provider>\r\n    </Form>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Table } from 'antd';\r\n\r\nimport EditableCell from './EditableCell';\r\nimport EditableRow from './EditableRow';\r\n\r\nexport default function EditableTable({ columns = [], dataSource = [], ...rest }) {\r\n  return (\r\n    <Table\r\n      bordered\r\n      className=\"compact-table\"\r\n      size=\"small\"\r\n      pagination={false}\r\n      columns={columns}\r\n      dataSource={dataSource}\r\n      components={{\r\n        body: {\r\n          row: EditableRow,\r\n          cell: EditableCell,\r\n        },\r\n      }}\r\n      {...rest}\r\n    />\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Button } from 'antd';\r\nimport { groupBy, property, get } from 'lodash';\r\nimport currency from 'currency.js';\r\nimport clsx from 'clsx';\r\n\r\nimport EditableTable from '../editable-table/EditableTable';\r\n\r\nconst renderer = (dataIndex) => (value, record) => {\r\n  return (\r\n    <div\r\n      className={clsx('p-2', { 'text-red-500': Number(get(record, dataIndex)) !== Number(value) })}>\r\n      {currency(value, { separator: ',', symbol: '', precision: 2 }).format()}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst COLUMNS = ({ groupByGroup = {} } = {}) => [\r\n  {\r\n    title: '',\r\n    colSpan: 0,\r\n    dataIndex: 'group',\r\n    width: '12.5%',\r\n    render: (value, row) => {\r\n      const values = groupByGroup[value];\r\n      return {\r\n        children: <div className=\"pl-2\">{value}</div>,\r\n        props: {\r\n          rowSpan: values[0].item === row.item ? values.length : 0,\r\n          colSpan: row.item === '' ? 2 : 1,\r\n        },\r\n      };\r\n    },\r\n  },\r\n  {\r\n    title: '項目',\r\n    colSpan: 2,\r\n    children: [\r\n      {\r\n        title: 'item',\r\n        dataIndex: 'item',\r\n        colSpan: 2,\r\n        rowSpan: 2,\r\n        width: '12.5%',\r\n        render: (value) => {\r\n          return {\r\n            children: <div className=\"pl-2\">{value}</div>,\r\n            props: {\r\n              colSpan: value === '' ? 0 : 1,\r\n            },\r\n          };\r\n        },\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    title: '台灣',\r\n    children: [\r\n      {\r\n        title: 'Taiwan',\r\n        children: [\r\n          {\r\n            title: 'A',\r\n            dataIndex: ['tw', 'A'],\r\n            align: 'right',\r\n            render: renderer(['tw', 'B']),\r\n            editable: true,\r\n            width: '12.5%',\r\n          },\r\n          {\r\n            title: 'B',\r\n            dataIndex: ['tw', 'B'],\r\n            align: 'right',\r\n            render: renderer(['tw', 'A']),\r\n            editable: true,\r\n            width: '12.5%',\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    title: '大陸',\r\n    children: [\r\n      {\r\n        title: 'China',\r\n        dataIndex: 'cn',\r\n        children: [\r\n          {\r\n            title: 'A',\r\n            dataIndex: ['cn', 'A'],\r\n            align: 'right',\r\n            render: renderer(['cn', 'B']),\r\n            editable: true,\r\n            width: '12.5%',\r\n          },\r\n          {\r\n            title: 'B',\r\n            dataIndex: ['cn', 'B'],\r\n            align: 'right',\r\n            render: renderer(['cn', 'A']),\r\n            editable: true,\r\n            width: '12.5%',\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    title: '歐美',\r\n    children: [\r\n      {\r\n        title: 'Europe / Mexico',\r\n        dataIndex: 'eu',\r\n        children: [\r\n          {\r\n            title: 'A',\r\n            dataIndex: ['eu', 'A'],\r\n            align: 'right',\r\n            render: renderer(['eu', 'B']),\r\n            editable: true,\r\n            width: '12.5%',\r\n          },\r\n          {\r\n            title: 'B',\r\n            dataIndex: ['eu', 'B'],\r\n            align: 'right',\r\n            render: renderer(['eu', 'A']),\r\n            editable: true,\r\n            width: '12.5%',\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n];\r\n\r\nconst DATA_SOURCE = [\r\n  {\r\n    group: '不可再生類別',\r\n    item: '柴油',\r\n    tw: { A: 3.24, B: 3.25 },\r\n    cn: { A: 9.59, B: 9.59 },\r\n    eu: { A: 2.51, B: 2.51 },\r\n  },\r\n  {\r\n    group: '不可再生類別',\r\n    item: '天然氣',\r\n    tw: { A: 0.0, B: 0.0 },\r\n    cn: { A: 2654.67, B: 2654.67 },\r\n    eu: { A: 560.37, B: 560.37 },\r\n  },\r\n  {\r\n    group: '不可再生類別',\r\n    item: '汽油',\r\n    tw: { A: 93.73, B: 93.73 },\r\n    cn: { A: 315.38, B: 315.38 },\r\n    eu: { A: 2.21, B: 2.21 },\r\n  },\r\n  {\r\n    group: '不可再生類別',\r\n    item: '暖氣',\r\n    tw: { A: 0.0, B: 0.0 },\r\n    cn: { A: 0.0, B: 0.0 },\r\n    eu: { A: 3313.25, B: 3313.25 },\r\n  },\r\n\r\n  {\r\n    group: '可再生能源',\r\n    item: '外購-水力發電 (度)',\r\n    tw: { A: 0.0, B: 0.0 },\r\n    cn: { A: 35912441.66, B: 35912441.66 },\r\n    eu: { A: 0.0, B: 0.0 },\r\n  },\r\n  {\r\n    group: '可再生能源',\r\n    item: '自產-太陽能發電 (度)',\r\n    tw: { A: 0.0, B: 0.0 },\r\n    cn: { A: 2393900.79, B: 2393900.79 },\r\n    eu: { A: 0.0, B: 0.0 },\r\n  },\r\n  {\r\n    group: '可再生能源',\r\n    item: '外購-風力發電 (度)',\r\n    tw: { A: 0.0, B: 0.0 },\r\n    cn: { A: 0.0, B: 0.0 },\r\n    eu: { A: 0.0, B: 0.0 },\r\n  },\r\n\r\n  {\r\n    group: '外購-一般電力 (度)',\r\n    item: '',\r\n    tw: { A: 37559053.24, B: 37559053.24 },\r\n    cn: { A: 359948681.49, B: 359948681.49 },\r\n    eu: { A: 39533001.36, B: 39533001.36 },\r\n  },\r\n];\r\n\r\nexport default function CsrReport() {\r\n  function handleSave(row) {\r\n    setDataSource((prev) => prev.map((data) => (data.item === row.item ? row : data)));\r\n  }\r\n\r\n  const groupByGroup = groupBy(DATA_SOURCE, property('group'));\r\n  const columns = COLUMNS({ groupByGroup }).map((col) => ({\r\n    ...col,\r\n    ...(col.children && {\r\n      children: col.children.map((_col) => ({\r\n        ..._col,\r\n        ...(_col.children && {\r\n          children: _col.children.map((__col) => ({\r\n            ...__col,\r\n            ...(__col.editable && {\r\n              onCell: (record) => ({\r\n                handleSave,\r\n                record,\r\n                editable: __col.editable,\r\n                dataIndex: __col.dataIndex,\r\n                title: __col.title,\r\n              }),\r\n            }),\r\n          })),\r\n        }),\r\n      })),\r\n    }),\r\n  }));\r\n\r\n  const [dataSource, setDataSource] = useState(DATA_SOURCE);\r\n  return (\r\n    <div>\r\n      <div className=\"flex\">\r\n        <Button>Upload A</Button>\r\n        <Button>Upload B</Button>\r\n      </div>\r\n      <EditableTable\r\n        style={{ width: 1080 }}\r\n        columns={columns}\r\n        dataSource={dataSource}\r\n        rowKey=\"item\"\r\n      />\r\n      <Button>Submit</Button>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\n\nimport { CsrReport } from './components';\n\nexport default function App() {\n  return (\n    <div className=\"w-screen h-screen\">\n      <CsrReport />\n    </div>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport 'antd/dist/antd.css';\n\nimport './index.css';\nimport App from './App.jsx';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals();\n"],"sourceRoot":""}